# IndexNow Protocol Implementation

## Обзор

Наша реализация IndexNow полностью соответствует требованиям Яндекса для автоматического уведомления поисковых систем об изменениях на сайте.

## Настройка ключа IndexNow

### 1. Ключ IndexNow
- **Ключ**: `lavillapine2025indexnow123456789abcdef`
- **Расположение**: `https://lavillapine.onrender.com/indexnow-key.txt`
- **Длина**: 35 символов (в пределах рекомендуемого диапазона 8-128 символов)
- **Проверка**: Ключ автоматически проверяется при каждом запросе

### 2. Соответствие требованиям Яндекса

#### ✅ Подтверждение владения сайтом
- Ключ размещен на сайте по адресу `/indexnow-key.txt`
- Ключ передается в каждом запросе к API
- Яндекс автоматически проверяет ключ при каждом запросе

#### ✅ Поддержка методов API
- **GET-запросы**: Для отправки одного URL (рекомендуется Яндексом)
- **POST-запросы**: Для отправки нескольких URL одновременно

#### ✅ Правильные endpoints
- **Yandex**: `https://yandex.com/indexnow`
- **Bing**: `https://www.bing.com/indexnow`

## API Endpoints

### 1. Отправка уведомления для одного URL
```bash
POST /api/indexnow/single
Content-Type: application/json

{
  "url": "https://lavillapine.onrender.com/about"
}
```

### 2. Отправка уведомлений для нескольких URL
```bash
POST /api/indexnow
Content-Type: application/json

{
  "urls": [
    "https://lavillapine.onrender.com/",
    "https://lavillapine.onrender.com/about",
    "https://lavillapine.onrender.com/gallery"
  ]
}
```

### 3. Уведомление всех страниц сайта
```bash
POST /api/indexnow/all
```

### 4. Получение ключа IndexNow
```bash
GET /api/indexnow/key
```

### 5. Проверка настройки IndexNow
```bash
GET /api/indexnow/validate
```

## Особенности реализации

### 1. Умный выбор метода
- Для одного URL используется GET-запрос (рекомендация Яндекса)
- Для нескольких URL используется POST-запрос
- Если GET-запрос не удался, автоматически используется POST

### 2. Валидация URL
- Все URL проверяются на принадлежность к домену `lavillapine.onrender.com`
- Отклоняются URL с других доменов

### 3. Подробное логирование
- Каждый запрос логируется с деталями
- Отслеживается успешность отправки в каждую поисковую систему
- Логируются коды ошибок и их описания

### 4. Обработка ошибок
- Graceful обработка недоступности поисковых систем
- Возврат подробной информации о статусе операции
- Продолжение работы даже при частичных сбоях

## Административная панель

Доступна по адресу `/admin` с функциями:
- Уведомление всех страниц сайта
- Уведомление конкретных URL
- Обновление sitemap
- Комбинированное обновление sitemap + IndexNow
- Проверка статуса IndexNow ключа

## Интеграция с Sitemap

IndexNow работает в связке с sitemap.xml:
- Sitemap автоматически обновляется с текущими датами
- IndexNow уведомляет поисковые системы о всех URL из sitemap
- Единая команда для обновления sitemap и отправки IndexNow

## Соответствие протоколу IndexNow

### Поддерживаемые поисковые системы
- ✅ Яндекс (`https://yandex.com/indexnow`)
- ✅ Bing (`https://www.bing.com/indexnow`)

### Формат запросов
- ✅ GET для одного URL
- ✅ POST для нескольких URL
- ✅ JSON формат данных
- ✅ Правильные заголовки HTTP

### Безопасность
- ✅ Проверка ключа на каждом запросе
- ✅ Валидация домена
- ✅ User-Agent идентификация

## Рекомендации по использованию

1. **Когда использовать IndexNow**:
   - При добавлении новых страниц
   - При обновлении существующих страниц
   - При удалении страниц
   - При значительных изменениях контента

2. **Когда НЕ использовать**:
   - Для массовых уведомлений без изменений
   - Для страниц, которые не изменились
   - Слишком часто (избегайте спама)

3. **Лучшие практики**:
   - Уведомляйте только о реальных изменениях
   - Используйте функцию "Обновить всё" после значительных изменений
   - Регулярно проверяйте статус ключа IndexNow
   - Следите за логами для выявления проблем

## Мониторинг и отладка

Все операции IndexNow логируются в консоли сервера:
- Успешные отправки
- Коды ошибок
- Детали запросов
- Статусы ответов от поисковых систем

Для отладки используйте endpoint `/api/indexnow/validate` для проверки конфигурации.